{
  "apiVersion": "1.0.0",
  "metadata": {
    "name": "fuse-workshop"
  },
  "projects": [
    {
      "name": "fuse-workshop",
      "source": {
        "type": "git",
        "location": "https://github.com/GuilhermeCamposo/fuse-workshop.git"
      }
    }
  ],
  "components": [
    {
      "type": "chePlugin",
      "id": "redhat/vscode-apache-camel/latest",
      "alias": "vscode-camel"
    },
    {
      "type": "chePlugin",
      "id": "redhat/vscode-openshift-connector/latest",
      "alias": "vscode-openshift"
    },
    {
      "type": "dockerimage",
      "alias": "tools",
      "image": "quay.io/weimeilin79/java8tools:latest",
      "env": [
        {
          "name": "MAVEN_CONFIG",
          "value": ""
        },
        {
          "name": "JAVA_OPTS",
          "value": "-XX:MaxRAMPercentage=50.0 -XX:+UseParallelGC -XX:MinHeapFreeRatio=10 -XX:MaxHeapFreeRatio=20 -XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90 -Dsun.zip.disableMemoryMapping=true -Xms20m -Djava.security.egd=file:/dev/./urandom -Duser.home=/home/user"
        },
        {
          "name": "MAVEN_OPTS",
          "value": "$(JAVA_OPTS)"
        }
      ],
      "memoryLimit": "4294Mi",
      "endpoints": [
        {
          "name": "8080-tcp",
          "port": 8080
        },
        {
          "name": "debug",
          "port": 5005,
          "attributes": {
            "public": "false"
          }
        }
      ],
      "mountSources": true,
      "volumes": [
        {
          "name": "m2",
          "containerPath": "/home/user/.m2"
        }
      ]
    }
  ],
  "commands": [
    {
      "name": "maven build",
      "actions": [
        {
          "type": "exec",
          "component": "tools",
          "command": "mvn clean install",
          "workdir": "${CHE_PROJECTS_ROOT}/fuse-workshop"
        }
      ]
    },
    {
      "name": "log in openshift",
      "actions": [
        {
          "type": "exec",
          "component": "tools",
          "command": "oc login -p openshift -u {{ user }} --server=https://api.{{ domain }}:6443 --insecure-skip-tls-verify={{ insecure_skip_tls_verify }} && oc project {{ user }}-project",
          "workdir": "${CHE_PROJECTS_ROOT}/fuse-workshop"
        }
      ]
    },

    {
      "name": "run app locally",
      "actions": [
        {
          "type": "exec",
          "component": "tools",
          "command": "mvn clean spring-boot:run\n",
          "workdir": "${CHE_PROJECTS_ROOT}/fuse-workshop"
        }
      ]
    },
    {
      "name": "deploy to openshift",
      "actions": [
        {
          "type": "exec",
          "component": "tools",
          "command": "mvn clean fabric8:deploy -P openshift -DskipTests -Dspring.profiles.active=prod -Dfabric8.generator.from=fuse7-java-openshift:1.7 \n",
          "workdir": "${CHE_PROJECTS_ROOT}/fuse-workshop"
        }
      ]
    },
    {
      "name": "Debug remote java application",
      "actions": [
        {
          "type": "vscode-launch",
          "referenceContent": "{\n\"version\": \"0.2.0\",\n\"configurations\": [\n  {\n    \"type\": \"java\",\n    \"name\": \"Debug (Attach) - Remote\",\n    \"request\": \"attach\",\n    \"hostName\": \"localhost\",\n    \"port\": 5005\n  }]\n}\n"
        }
      ]
    }
  ]
}
